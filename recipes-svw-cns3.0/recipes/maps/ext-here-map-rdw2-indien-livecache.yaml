metaEnvironment:
   PKG_RESPONSIBLE: "Navigation-Vorintegration"

environment:
   PKG_VERSION: "MRM_1PR004_CT3WS-18135_MRM2_Pre_Installed"
   PKG_HASH: "eb42a91d57af24a98f3c9b7045f0dd5740b30584"


   MAP_LOCATION: "maps"

checkoutSCM:
  - if: $(eq,${mapupdate:-0},0)
    scm: url
    url: ${DEFAULT_DOWNLOAD_SCM_URL}${MAP_LOCATION}/${PKG_VERSION}.tar
    digestSHA1: ${PKG_HASH}
    extract: no

buildScript: |
   rm -rf *
   ln -sf $1/*tar
packageVars: [PKG_VERSION]
multiPackage:
   pkg:
      inherit: [packing-module]
      packageScript: |
         mkdir -p tmp/var/lib/nav/map
         tar xf $1/*.tar -C tmp/var/lib/nav/map
         echo ${PKG_VERSION} > tmp/var/lib/nav/map/map.version
         buildSwupModule -n 'map' -p "emmc.maps" -o 'map::ext-here-map-rdw2-indien-livecache' -f tmp \
            -m 'display,display,0775,/var/lib/nav/map/SDS$'   \
            -m 'display,display,0775,/var/lib/nav/map/SDS/.*' \
            -m 'display,display,0775,/var/lib/nav/map/[^/]+/SDS$'   \
            -m 'display,display,0775,/var/lib/nav/map/[^/]+/SDS/.*' \
            -m 'display,display,0771,/var/lib/nav$'           \
            -m 'display,display,0771,/var/lib/nav/.*' --      \
            --requiredBy '{"Packages":[{"PackageName":"prescripts.map-delete","Flags":"Selected"},{"PackageName":"prescripts.updatemanager-delete","Flags":"Selected"}]}' \
            -U "Partition=rootfs_ro" \
            -U "Optional=True"

         rm -rf tmp

   target:
      packageScript: |
         mkdir -p var/lib/nav/map
         pushd var/lib/nav/map
         echo ${PKG_VERSION} > map.version
         tar xf $1/*tar

   cloud:
      packageScript: |
         mkdir -p usr/bin/map
         pushd usr/bin/map
         echo ${PKG_VERSION} > map.version
         tar xf $1/*tar

provideVars:
   TRAIN_PKG_VERSION: ${PKG_VERSION}
