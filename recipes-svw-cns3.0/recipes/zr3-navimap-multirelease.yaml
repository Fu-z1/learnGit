inherit: [packing-multirelease]

buildVars:
  - MAP_REGION
  - TRAIN_NAME
  - TRAIN_PREFIX
  - TRAIN_PKG_VERSION
  - MR_TRAIN_SUFFIX
  - MU_VERSION

buildScript: |
   rm -rf *

   MAP="input/${MAP_REGION}"
   MAP_sec="input/${MAP_REGION}_sec"

   mkdir -p ${MAP}
   mkdir -p ${MAP_sec}
   cp -r ${BOB_DEP_PATHS[zr3-navimap-${MAP_REGION}]}/UpdateContainer/* ${MAP}
   cp -r ${BOB_DEP_PATHS[zr3-navimap-${MAP_REGION}_sec]}/UpdateContainer/* ${MAP_sec}

packageVars:
  - MAP_REGION
  - TRAIN_NAME
  - TRAIN_PREFIX
  - TRAIN_PKG_VERSION
  - MR_TRAIN_SUFFIX
  - MU_VERSION

packageScript: |
   rsync -a --delete $1/ .

   TRAIN_NAME=${TRAIN_PREFIX}_${TRAIN_PKG_VERSION}_${MR_TRAIN_SUFFIX}

   OUTPUT_DIRECTORY="UpdateContainer"

   buildSwupMultiRelease -i "input" \
      -n ${TRAIN_NAME} \
      -o ${OUTPUT_DIRECTORY}

   rm -rf input

multiPackage:
   # Variant package fragment generated by genNavimapsMultirelease.py. Do not waste your
   # time with editing. Re-generate variant data from and with pure::variants
   # JSON export and genNavimapsMultirelease.py.
   #
   # The lines below are intended to be used as multiPackage elements in
   # zr3-navimap-multirelease.yaml.
   EU1:
      depends:
         - name: zr3-navimap-EU1
           use: [result, environment]
         - name: zr3-navimap-EU1_sec
      environment:
         MAP_REGION: "EU1"
         MR_TRAIN_SUFFIX: "M_${MAP_MAJOR}_${MAP_DELIVERY}_${MAP_BUILDREF}_P"
   EU2:
      depends:
         - name: zr3-navimap-EU2
           use: [result, environment]
         - name: zr3-navimap-EU2_sec
      environment:
         MAP_REGION: "EU2"
         MR_TRAIN_SUFFIX: "M_${MAP_MAJOR}_${MAP_DELIVERY}_${MAP_BUILDREF}_P"
   JP:
      depends:
         - name: zr3-navimap-JP
           use: [result, environment]
         - name: zr3-navimap-JP_sec
      environment:
         MAP_REGION: "JP"
         MR_TRAIN_SUFFIX: "M_${MAP_MAJOR}_${MAP_DELIVERY}_${MAP_BUILDREF}_P"
   KR:
      depends:
         - name: zr3-navimap-KR
           use: [result, environment]
         - name: zr3-navimap-KR_sec
      environment:
         MAP_REGION: "KR"
         MR_TRAIN_SUFFIX: "M_${MAP_MAJOR}_${MAP_DELIVERY}_${MAP_BUILDREF}_P"
   RDW1:
      depends:
         - name: zr3-navimap-RDW1
           use: [result, environment]
         - name: zr3-navimap-RDW1_sec
      environment:
         MAP_REGION: "RDW1"
         MR_TRAIN_SUFFIX: "M_${MAP_MAJOR}_${MAP_DELIVERY}_${MAP_BUILDREF}_P"
   RDW2:
      depends:
         - name: zr3-navimap-RDW2
           use: [result, environment]
         - name: zr3-navimap-RDW2_sec
      environment:
         MAP_REGION: "RDW2"
         MR_TRAIN_SUFFIX: "M_${MAP_MAJOR}_${MAP_DELIVERY}_${MAP_BUILDREF}_P"
   RDW2_INDIEN:
      depends:
         - name: zr3-navimap-RDW2_INDIEN
           use: [result, environment]
         - name: zr3-navimap-RDW2_INDIEN_sec
      environment:
         MAP_REGION: "RDW2_INDIEN"
         MR_TRAIN_SUFFIX: "M_${MAP_MAJOR}_${MAP_DELIVERY}_${MAP_BUILDREF}_P"
   DACHCZ:
      depends:
         - name: zr3-navimap-DACHCZ
           use: [result, environment]
         - name: zr3-navimap-DACHCZ_sec
      environment:
         MAP_REGION: "DACHCZ"
         MR_TRAIN_SUFFIX: "M_${MAP_MAJOR}_${MAP_DELIVERY}_${MAP_BUILDREF}_P"
