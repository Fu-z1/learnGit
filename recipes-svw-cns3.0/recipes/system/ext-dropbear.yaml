inherit: [autotools, packing-module]

metaEnvironment:
   PKG_LICENSE: "BSD-2-Clause"
   PKG_VERSION: "2014.65"
   PKG_NAME: "dropbear"
   PKG_RESPONSIBLE: "System-System"

depends:
  - libs::ext-zlib-dev
  - use: []
    depends:
      - libs::ext-zlib-target

checkoutSCM:
   scm: url
   url: ${DEFAULT_DOWNLOAD_SCM_URL}src/ext-dropbear/dropbear-${PKG_VERSION}.tar.bz2
   digestSHA1: "a7b04ff3c27059477ecdd8dccef7d43f644abe46"

buildVars: [SYSROOT, CROSS_COMPILE, ARCH, CC, LD, PKG_VERSION]
buildScript: |
   export MULTI=1
   export PROGRAMS="dropbear dbclient dropbearkey dropbearconvert scp"

   cp $1/dropbear-${PKG_VERSION}/dropbear.8 .
   autotoolsBuild $1/dropbear-${PKG_VERSION}

packageScript: |
   autotoolsPackageTarget
   d=$(mktemp -d)
   rsync -a --delete --exclude ".debug" ./ $d
   buildSwupModule -n "ext-dropbear" \
      -p "emmc.system" \
      -o "system:ext-dropbear " -f $d -- \
      -U "Partition=rootfs_ro"
   rm -rf $d

provideDeps: ["*-target"]
