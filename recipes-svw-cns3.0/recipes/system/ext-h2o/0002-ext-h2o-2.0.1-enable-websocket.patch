--- CMakeLists.txt
+++ CMakeLists.txt
@@ -319,13 +319,13 @@ IF (ZLIB_FOUND)
     LIST(INSERT EXTRA_LIBS 0 ${ZLIB_LIBRARIES})
 ENDIF (ZLIB_FOUND)
 
-ADD_LIBRARY(libh2o ${LIB_SOURCE_FILES})
+ADD_LIBRARY(libh2o ${LIB_SOURCE_FILES} lib/websocket.c)
 SET_TARGET_PROPERTIES(libh2o PROPERTIES
     OUTPUT_NAME h2o
     VERSION ${LIBRARY_VERSION}
     SOVERSION ${LIBRARY_SOVERSION})
 TARGET_LINK_LIBRARIES(libh2o ${LIBUV_LIBRARIES} ${EXTRA_LIBS})
-ADD_LIBRARY(libh2o-evloop ${LIB_SOURCE_FILES})
+ADD_LIBRARY(libh2o-evloop ${LIB_SOURCE_FILES} lib/websocket.c)
 SET_TARGET_PROPERTIES(libh2o-evloop PROPERTIES
     OUTPUT_NAME h2o-evloop
     COMPILE_FLAGS "-DH2O_USE_LIBUV=0"
