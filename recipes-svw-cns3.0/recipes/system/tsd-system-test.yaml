inherit: [buildenv, packing-module]

checkoutSCM:
   scm: git
   url: git@${DEFAULT_PCC_GIT_SERVER}:mib3-system/tsd.system.test.git
   dir: tsd.system.test
   tag: 1.5.0
   branch: master_mqb_sop1_eu

buildScript: |
   buildenvBuildAll
   mkdir -p dist/usr/bin
   rsync -a --delete $1/tsd.system.test/filesystemcheck/src/tsd/system/test/filesystemcheck/* dist/usr/bin
   rsync -a --delete $1/tsd.system.test/stress-ng/src/tsd/system/test/stress-ng/cpustress.sh dist/usr/bin
   rsync -a --delete $1/tsd.system.test/stress-ng/src/tsd/system/test/stress-ng/ramstress.sh dist/usr/bin
   rsync -a --delete $1/tsd.system.test/glmark2/gpustress.sh dist/usr/bin
   mkdir -p dist/usr/lib/systemd/system
   rsync -a --delete $1/tsd.system.test/services/* dist/usr/lib/systemd/system

packageScript: |
   buildenvPackageTarget
   d=$(mktemp -d)
   rsync -a --delete --exclude ".debug" ./ $d
   buildSwupModule -n "system-test" \
      -p "emmc.system" \
      -o "system:tsd-system-test " -f $d -- \
      -U "Partition=rootfs_ro"
   rm -rf $d
