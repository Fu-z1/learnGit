inherit: [packing-module]

metaEnvironment:
   PKG_LICENSE: "Hanwang Technology Company"
   PKG_VERSION: "1.5"
   PKG_NAME: "ime"
   PKG_PATCH_VERSION: "1.0.0"
   PKG_RESPONSIBLE: "MMI-HMI"

checkoutSCM:
   scm: git
   url: git@${DEFAULT_PCC_GIT_SERVER}:mib3-hmi/ext.ime.git
   branch: main/svw_cns3.0_dev

buildTools: [buildenv]
buildVars: [AUTOCONF_HOST, LIBDIR]

multiPackage:
   dev:
      buildScript: |
         mkdir -p ./usr
         mkdir -p ./var
         cp -a $1/usr/include ./usr/
         cp -a $1/usr/lib ./usr/
         mkdir -p ./var/lib/tsd.ime
         cp -a $1/usr/share/Dic ./var/lib/tsd.ime
         tsd-buildenv-create-shim.sh -p usr -L lib -I include -l HWKeyboard_x86 ext.ime
      packageScript: |
         cp -a $1/* .
   target:
      buildScript: |
         mkdir -p ./usr
         mkdir -p ./var
         cp -a $1/usr/include ./usr/
         cp -a $1/usr/lib ./usr/
         mkdir -p var/lib/tsd.ime
         cp -a $1/usr/share/Dic ./var/lib/tsd.ime
         tsd-buildenv-create-shim.sh -p usr -L lib -I include -l HWKeyboard ext.ime
      packageScript: |
         cp -a $1/* .
         d=$(mktemp -d)
         rsync -a --delete --exclude ".debug" ./ $d
         buildSwupModule -n "ext-ime" \
            -p "emmc.hmi" \
            -m 'ime,ime,0770,/var/lib/tsd.ime$'   \
            -m 'ime,ime,0770,/var/lib/tsd.ime/.*' \
            -o "hmi:ext-ime " -f $d -- \
            -U "Partition=rootfs_ro"
         rm -rf $d
