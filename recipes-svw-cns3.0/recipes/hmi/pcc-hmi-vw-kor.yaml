inherit: [packing-module, patch]

metaEnvironment:
   PKG_RESPONSIBLE: "MMI-Vorintegration"

multiPackage:
   high-pkg:
      privateEnvironment:
         VARIANT_NAME: "high"
         VARIANT_LIST: "$(getMatchingVariantStrings,SW_HMI_REGION=kr,SW_HMI_BRAND=vw,HW_DISPLAY_VARIANT=1280640,SW_HMI_PROJECT=MQB)"

      checkoutSCM:
         scm: url
         url: ${DEFAULT_DOWNLOAD_SCM_URL}src/hmi/hmi_deliveries/HMI_H40.60.09.01/ext.vw.kor.high.tar.gz
         digestSHA1: "2f3b6dbb6f49c9cb46d2436e2e92a9c92c4205ae"

   low-pkg:
      privateEnvironment:
         VARIANT_NAME: "low"
         VARIANT_LIST: "$(getMatchingVariantStrings,SW_HMI_REGION=kr,SW_HMI_BRAND=vw,HW_DISPLAY_VARIANT=800480,SW_HMI_PROJECT=MQB)"

      checkoutSCM:
         scm: url
         url: ${DEFAULT_DOWNLOAD_SCM_URL}src/hmi/hmi_deliveries/HMI_H40.60.09.01/ext.vw.kor.low.tar.gz
         digestSHA1: "cd2a64e9425e40896931aaae4c3ca3597f3fdd25"

checkoutDeterministic: true

buildScript: |
   rm -rf *
   ln -sf $1/* .

packageVars: [VARIANT_NAME, VARIANT_LIST]
packageScript: |
   mkdir -p tmp/tsd
   rsync -a --delete $1/ext.vw.kor.${VARIANT_NAME}/tsd/* tmp/tsd
   mkdir -p tmp/var/lib/hmi
   buildSwupModule -n "pcc-hmi-vw-kor" -p "emmc.hmi" -v "${VARIANT_NAME}" \
       -m 'display,display,0700,/var/lib/hmi$'    \
       -m 'display,display,0700,/var/lib/hmi/.*'  \
       -o 'hmi::pcc-hmi-vw-kor' -f tmp -- \
       --variantList $VARIANT_LIST \
       --requiredBy '{"Packages":[{"PackageName":"prescripts.hmi-delete","Flags":"Selected"},{"PackageName":"scripts.set-hmi-files","Flags":"Selected"},{"PackageName":"emmc.hmi.ext-zulu","Flags":"Selected"}]}' \
       -U "Partition=rootfs_ro"
   rm -rf tmp
