inherit: [buildenv]

depends:
   - swi::pcc-swi-btf-common-api-dev

   - system::tsd-common-dev
   - communication::tsd-communication-dev
   - system::ext-cppunit-google-mock-dev
   - navigation::ext-tinyxml-dev

checkoutSCM:
   -
      scm: git
      url: git@git-repo.server.technisat-digital:swi-btf/pcc.swi.btf.common.git
      dir: pcc.swi.btf.common
      branch: master_mqb_sop1_eu
      tag: "${PCC_SWI_BTF_COMMON_VERSION:-}"

buildVars: [PCC_SWI_BTF_COMMON_VERSION]
multiPackage:
   dev:
      buildScript: |
         if [ -d "$1/pcc.swi.btf.common/.git" ]; then
            # get the real version from git
            pushd $1/pcc.swi.btf.common
            GIT_VERSION=$(git describe --abbrev=4 --dirty --always --tags)
            popd
         else
            # we are in sandbox and can take the git tag checked output
            GIT_VERSION=${PCC_SWI_BTF_COMMON_VERSION:-unknown}
         fi
         buildenvBuildAll -DGIT_VERSION=$GIT_VERSION

      packageScript: |
         buildenvPackageDev

      provideDeps: [ "*-dev" ]

   app:
      buildScript: |
         makeParallel pcc.swi.btf.common.app.loggerTest

      packageScript: |
         buildenvPackageTarget

   doc:
      buildTools: [doxygen, dot]
      buildScript: buildenvBuildDocAll
      packageScript: buildenvPackageDoc
