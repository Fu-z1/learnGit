inherit: [make, packing-module]

metaEnvironment:
   PKG_RESPONSIBLE: Connect-Onlineservices

environment:
   VERSION: "7.12.1"

checkoutSCM:
   scm: url
   url: http://ftp.gnu.org/gnu/gdb/gdb-${VERSION}.tar.gz
   digestSHA1: "e0dfaa153d162ae23fd81d05ea87864a634b6da8"

buildVars: [VERSION]
buildScript: |
   BUILD_DIR=${PWD}
   $1/gdb-${VERSION}/configure --prefix=${BUILD_DIR} --target=arm-linux-gnueabi --srcdir=$1/gdb-${VERSION}
   make
   make install

packageScript: |
   rsync -a --delete $1/ ${PWD}
   d=$(mktemp -d)
   rsync -a --delete --exclude ".debug" ./ $d
   buildSwupModule -n "ext-gdb" \
      -p "emmc.onlineservices" \
      -o "onlineservices:ext-gdb " -f $d -- \
      -U "Partition=rootfs_ro"
   rm -rf $d
